<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark PDF Viewer</title>
    <style>
        body {
            margin: 0;
            background: #000;
            font-family: Arial, sans-serif;
        }
        
        .toolbar {
            background: #333;
            padding: 10px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pdf-info {
            color: #aaa;
            font-size: 11px;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .toolbar {
                padding: 4px;
                font-size: 11px;
            }
            
            button {
                padding: 3px 6px !important;
                margin: 0 1px !important;
                font-size: 11px;
            }
            
            input[type="file"] {
                padding: 3px 5px !important;
                font-size: 11px;
            }
            
            .toolbar span {
                font-size: 9px;
            }

            #pdf-viewer {
                height: calc(100vh - 45px);
            }
        }

        @media (max-width: 480px) {
            .toolbar span {
                display: none;
            }
            
            .toolbar {
                padding: 2px;
            }
            
            button {
                padding: 2px 4px !important;
                margin: 0 !important;
                font-size: 10px;
                min-width: 22px;
            }

            input[type="file"] {
                padding: 2px 4px !important;
                font-size: 10px;
            }

            #pdf-viewer {
                height: calc(100vh - 35px);
            }
        }
        
        input[type="file"] {
            background: #555;
            color: white;
            border: none;
            padding: 8px;
            border-radius: 3px;
        }
        
        #pdf-viewer {
            width: 100%;
            height: calc(100vh - 60px);
            border: none;
            filter: invert(1) hue-rotate(180deg);
            transition: transform 0.3s ease;
        }

        button {
            background: #555;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 3px;
            cursor: pointer;
            margin: 0 5px;
        }

        button:hover {
            background: #666;
        }

        .toggle-active {
            background: #007acc !important;
        }

    </style>
</head>
<body>
    <div class="toolbar">
        <div>
            <input type="file" id="file-input" accept=".pdf" /> <br>
            <span id="pdf-info" class="pdf-info"></span>
        </div>
    </div>
    
    <embed id="pdf-viewer" type="application/pdf" />

    <script>
        let isPlaying = false;
        let scrollInterval;
        let scrollSpeed = 3;
        
        const pdfViewer = document.getElementById('pdf-viewer');

        // Load settings from localStorage
        function loadSettings() {
            scrollSpeed = parseInt(localStorage.getItem('scrollSpeed')) || 3;
            
            
            // Show last PDF info
            const currentPDF = localStorage.getItem('currentPDF');
            const pdfInfo = document.getElementById('pdf-info');
            if (currentPDF && pdfInfo) {
                pdfInfo.textContent = `Last: ${currentPDF}`;
                document.title = currentPDF;
            } else if (pdfInfo) {
                pdfInfo.textContent = 'No PDF loaded';
            }
        }


        // File input handler
        document.getElementById('file-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.type === 'application/pdf') {
                const url = URL.createObjectURL(file);
                pdfViewer.src = url;
                document.title = file.name;
                localStorage.setItem('currentPDF', file.name);
                
                // Update info display
                const pdfInfo = document.getElementById('pdf-info');
                if (pdfInfo) {
                    pdfInfo.textContent = file.name;
                }
                
                // Restore scroll position for this specific PDF
                setTimeout(() => {
                    const savedPosition = localStorage.getItem(`scrollPosition_${file.name}`);
                    if (savedPosition) {
                        try {
                            if (pdfViewer.contentWindow) {
                                pdfViewer.contentWindow.scrollTo(0, parseInt(savedPosition));
                            } else {
                                window.scrollTo(0, parseInt(savedPosition));
                            }
                        } catch (e) {
                            window.scrollTo(0, parseInt(savedPosition));
                        }
                    }
                }, 1500); // Wait longer for PDF to fully load
            }
        });

     

        // Make PDF viewer focusable
        pdfViewer.setAttribute('tabindex', '0');
        
        // Focus PDF on load and save scroll position
        pdfViewer.addEventListener('load', function() {
            setTimeout(() => {
                pdfViewer.focus();
                
                // Set up scroll position saving for this PDF
                const currentPDF = localStorage.getItem('currentPDF');
                if (currentPDF) {
                    // Save scroll position periodically
                    setInterval(() => {
                        try {
                            let scrollY = 0;
                            if (pdfViewer.contentWindow && pdfViewer.contentWindow.scrollY !== undefined) {
                                scrollY = pdfViewer.contentWindow.scrollY;
                            } else {
                                scrollY = window.scrollY;
                            }
                            localStorage.setItem(`scrollPosition_${currentPDF}`, scrollY);
                        } catch (e) {
                            localStorage.setItem(`scrollPosition_${currentPDF}`, window.scrollY);
                        }
                    }, 1000); // Save every second
                }
            }, 500);
        });

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
        });
        
        // Also call loadSettings() immediately in case DOMContentLoaded already fired
        loadSettings();
    </script>
</body>
</html>
